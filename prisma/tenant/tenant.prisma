generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client-tenant"
}

datasource db {
  provider = "postgresql"
  url      = env("TENANT_DATABASE_URL")
}

model Currency {
  id        String   @id @default(uuid())
  code      String   @unique // ISO ÐºÐ¾Ð´: UZS, USD, EUR
  name      String // ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð²Ð°Ð»ÑŽÑ‚Ñ‹
  symbol    String // Ð¡Ð¸Ð¼Ð²Ð¾Ð»: $, â‚¬, soâ€™m
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  product_prices ProductPrice[]
  kassas         Kassa[]
  payments       Payment[]
  transactions   Transaction[]
  sales          Sale[]
  sale_items     SaleItem[]
  purchases      Purchase[]
  from_transfers KassaTransfer[] @relation("FromCurrencyRelation")
  to_transfers   KassaTransfer[] @relation("ToCurrencyRelation")
  settings       Settings[]

  @@map("currencies")
}

model CurrencyRate {
  id             String   @id @default(uuid())
  baseCurrency   String
  targetCurrency String
  rate           Decimal
  date           DateTime @default(now())
}

model Organization {
  id      String  @id @default(uuid())
  name    String
  address String?
  phone   String? @unique
  email   String? @unique

  org_users OrganizationUser[]
  customers OrganizationCustomer[]

  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  products          Product[]
  product_prices    ProductPrice[]
  product_instances ProductInstance[] @relation("OrgProductInstances")
  kassas            Kassa[]
  payments          Payment[]
  transactions      Transaction[]
  sales             Sale[]
  purchases         Purchase[]
  stocks            Stock[]
  kassa_transfers   KassaTransfer[]
  settings          Settings?
  audit_logs        AuditLog[]
  documents         Document[]

  @@map("organizations")
}

model User {
  id                   String                 @id @default(uuid())
  email                String?                @unique
  password             String
  isActive             Boolean                @default(true) @map("is_active")
  profile              UserProfile?
  createdAt            DateTime               @default(now()) @map("created_at")
  updatedAt            DateTime               @updatedAt @map("updated_at")
  role                 Role?                  @relation(fields: [roleId], references: [id])
  roleId               String?
  org_links            OrganizationUser[]
  cutomer_links        OrganizationCustomer[]
  payments             Payment[]
  sales                Sale[]
  purchases            Purchase[]
  phone_numbers        UserPhone[]
  audit_logs           AuditLog[]
  documents            Document[]
  installment_payments InstallmentPayment[]

  @@map("users")
}

model UserProfile {
  id             String    @id @default(uuid())
  userId         String    @unique @map("user_id")
  firstName      String    @map("first_name")
  lastName       String    @map("last_name")
  patronymic     String?
  dateOfBirth    DateTime? @map("date_of_birth")
  gender         Gender    @default(OTHER)
  passportSeries String?   @map("passport_series")
  passportNumber String?   @map("passport_number")
  issuedBy       String?   @map("issued_by")
  issuedDate     DateTime? @map("issued_date")
  expiryDate     DateTime? @map("expiry_date")
  country        String?
  region         String?
  city           String?
  address        String?
  registration   String?
  district       String?   @map("district") // <--- Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÑŽÐ´Ð° hudud
  user           User      @relation(fields: [userId], references: [id])

  @@map("user_profiles")
}

model UserPhone {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  phone     String   @unique
  note      String?
  isPrimary Boolean  @default(false) @map("is_primary")
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user_phones")
}

model OrganizationUser {
  id             String       @id @default(uuid())
  organizationId String       @map("organization_id")
  userId         String       @map("user_id")
  role           OrgUserRole
  position       String?
  organization   Organization @relation(fields: [organizationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("organization_users")
}

model OrganizationCustomer {
  id                String            @id @default(uuid())
  organizationId    String            @map("organization_id")
  userId            String?           @map("user_id")
  name              String
  phone             String
  type              CustomerType
  isBlacklisted     Boolean           @default(false) @map("is_blacklisted")
  organization      Organization      @relation(fields: [organizationId], references: [id])
  user              User?             @relation(fields: [userId], references: [id])
  product_instances ProductInstance[] @relation("CustomerProductInstances")
  payments          Payment[]
  transactions      Transaction[]
  sales             Sale[]
  purchases         Purchase[]
  installments      Installment[]
  documents         Document[]

  @@map("organization_customers")
}

model Brand {
  id        String    @id @default(uuid())
  name      String    @unique
  products  Product[]
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")

  @@map("brands")
}

model Product {
  id             String    @id @default(uuid())
  organizationId String    @map("organization_id")
  name           String
  description    String?
  expiry_date    DateTime? @map("expiry_date")
  serial_number  String?   @unique @map("serial_number")
  barcode        String?   @unique

  brandId String? @map("brand_id")

  organization Organization      @relation(fields: [organizationId], references: [id])
  brand        Brand?            @relation(fields: [brandId], references: [id])
  categories   ProductCategory[]
  prices       ProductPrice[]
  instances    ProductInstance[]

  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  sele_items      SaleItem[]
  purchase_items  PurchaseItem[]
  stocks          Stock[]
  product_batches ProductBatch[]

  @@map("products")
}

model Category {
  id       String            @id @default(uuid())
  name     String            @unique
  products ProductCategory[] // ÑÐ²ÑÐ·ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ñ‡Ð½ÑƒÑŽ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("categories")
}

model ProductCategory {
  productId  String
  categoryId String

  product  Product  @relation(fields: [productId], references: [id])
  category Category @relation(fields: [categoryId], references: [id])

  @@id([productId, categoryId]) // ÑÐ¾ÑÑ‚Ð°Ð²Ð½Ð¾Ð¹ Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
  @@map("product_categories")
}

model ProductPrice {
  id             String        @id @default(uuid())
  productId      String        @map("product_id")
  organizationId String?       @map("organization_id")
  priceType      PriceType     @map("price_type")
  amount         Decimal       @map("amount")
  currencyId     String        @map("currency_id")
  currency       Currency      @relation(fields: [currencyId], references: [id])
  product        Product       @relation(fields: [productId], references: [id])
  organization   Organization? @relation(fields: [organizationId], references: [id])
  customerType   CustomerType? @map("customer_type") // CLIENT, SUPPLIER Ð¸ Ñ‚.Ð´.
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
}

model ProductInstance {
  id             String        @id @default(uuid())
  productId      String        @map("product_id")
  serialNumber   String        @unique @map("serial_number")
  currentOwnerId String?       @map("current_owner_id")
  currentStatus  ProductStatus @default(IN_STOCK) @map("current_status")
  organizationId String        @map("organization_id")

  product       Product               @relation(fields: [productId], references: [id])
  organization  Organization          @relation("OrgProductInstances", fields: [organizationId], references: [id])
  current_owner OrganizationCustomer? @relation("CustomerProductInstances", fields: [currentOwnerId], references: [id])
  transactions  ProductTransaction[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("product_instances")
}

model ProductTransaction {
  id                String        @id @default(uuid())
  productInstanceId String        @map("product_instance_id")
  fromCustomerId    String?       @map("from_customer_id")
  toCustomerId      String?       @map("to_customer_id")
  toOrganizationId  String?       @map("to_organization_id")
  saleId            String?       @map("sale_id") // ÑÐ²ÑÐ·ÑŒ Ñ Ð¿Ñ€Ð¾Ð´Ð°Ð¶ÐµÐ¹, ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
  action            ProductAction
  date              DateTime      @default(now())
  description       String?

  product_instance ProductInstance @relation(fields: [productInstanceId], references: [id])

  @@map("product_transactions")
}

model ProductBatch {
  id          String    @id @default(uuid())
  productId   String    @map("product_id")
  batchNumber String    @map("batch_number")
  expiryDate  DateTime? @map("expiry_date")
  quantity    Int
  isValid     Boolean   @default(true) @map("is_valid")

  product Product @relation(fields: [productId], references: [id])
}

model Stock {
  id             String   @id @default(uuid())
  organizationId String   @map("organization_id")
  productId      String   @map("product_id")
  quantity       Int      @default(0)
  updatedAt      DateTime @updatedAt @map("updated_at")

  organization Organization @relation(fields: [organizationId], references: [id])
  product      Product      @relation(fields: [productId], references: [id])

  @@map("stocks")
}

model Kassa {
  id             String  @id @default(uuid())
  organizationId String  @map("organization_id")
  name           String // Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: "ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ UZS", "Click", "USD ÐºÐ°ÑÑÐ°"
  type           String // Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑÐ°Ð¼ ÑƒÐºÐ°Ð¶ÐµÑ‚ Ñ‚Ð¸Ð¿ (Ð½Ð°Ð», Ð±Ð°Ð½Ðº, ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð½Ð°Ñ)
  currencyId     String  @map("currency_id")
  balance        Decimal @default(0.00)

  organization Organization @relation(fields: [organizationId], references: [id])
  currency     Currency     @relation(fields: [currencyId], references: [id])
  payments     Payment[]

  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  purchases          Purchase[]
  sales              Sale[]
  outgoing_transfers KassaTransfer[] @relation("FromKassaRelation")
  incoming_transfers KassaTransfer[] @relation("ToKassaRelation")

  @@map("kassas")
}

model KassaTransfer {
  id              String   @id @default(uuid())
  organizationId  String   @map("organization_id")
  fromKassaId     String   @map("from_kassa_id")
  toKassaId       String   @map("to_kassa_id")
  fromCurrencyId  String   @map("from_currency_id")
  toCurrencyId    String   @map("to_currency_id")
  rate            Decimal  @default(1) // ÐºÑƒÑ€Ñ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ 1 USD = 12500 UZS 
  amount          Decimal // ÑÑƒÐ¼Ð¼Ð° Ð² Ð²Ð°Ð»ÑŽÑ‚Ðµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ°
  convertedAmount Decimal  @map("converted_amount") // ÑÑƒÐ¼Ð¼Ð° Ð¿Ð¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÑÑ‡Ñ‘Ñ‚Ð° Ð² Ð²Ð°Ð»ÑŽÑ‚Ñƒ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ
  description     String?
  createdAt       DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [organizationId], references: [id])
  // ðŸŸ¢ Ð—Ð´ÐµÑÑŒ Ð¼Ñ‹ ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ relation name, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Kassa ÑƒÑ‡Ð°ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð²Ð°Ð¶Ð´Ñ‹
  from_kassa   Kassa        @relation("FromKassaRelation", fields: [fromKassaId], references: [id])
  to_kassa     Kassa        @relation("ToKassaRelation", fields: [toKassaId], references: [id])

  // ðŸŸ¢ Ð¢Ð¾ Ð¶Ðµ ÑÐ°Ð¼Ð¾Ðµ Ð´Ð»Ñ Currency
  from_currency Currency @relation("FromCurrencyRelation", fields: [fromCurrencyId], references: [id])
  to_currency   Currency @relation("ToCurrencyRelation", fields: [toCurrencyId], references: [id])

  @@map("kassa_transfers")
}

model Payment {
  id             String      @id @default(uuid())
  organizationId String      @map("organization_id")
  userId         String?     @map("user_id")
  customerId     String?     @map("customer_id")
  kassaId        String      @map("kassa_id")
  amount         Decimal
  currencyId     String      @map("currency_id")
  type           PaymentType
  description    String?

  // Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÑÑ‹Ð»ÐºÐ¸
  purchaseId String? @map("purchase_id")
  saleId     String? @map("sale_id")

  organization Organization          @relation(fields: [organizationId], references: [id])
  user         User?                 @relation(fields: [userId], references: [id])
  customer     OrganizationCustomer? @relation(fields: [customerId], references: [id])
  kassa        Kassa                 @relation(fields: [kassaId], references: [id])
  currency     Currency              @relation(fields: [currencyId], references: [id])

  purchase Purchase? @relation("PurchasePayments", fields: [purchaseId], references: [id])
  sale     Sale?     @relation("SalePayments", fields: [saleId], references: [id])

  createdAt            DateTime             @default(now()) @map("created_at")
  installment_payments InstallmentPayment[]

  @@map("payments")
}

model Transaction {
  id             String      @id @default(uuid())
  organizationId String      @map("organization_id")
  customerId     String      @map("customer_id")
  relatedType    RelatedType @map("related_type")
  relatedId      String      @map("related_id") // SaleId, PurchesId......
  date           DateTime    @default(now())
  debit          Decimal     @default(0)
  credit         Decimal     @default(0)
  balanceAfter   Decimal     @map("balance_after")
  currencyId     String      @map("currency_id")
  description    String?

  organization Organization         @relation(fields: [organizationId], references: [id])
  customer     OrganizationCustomer @relation(fields: [customerId], references: [id])
  currency     Currency             @relation(fields: [currencyId], references: [id])

  @@map("transactions")
}

model Sale {
  id             String     @id @default(uuid())
  organizationId String     @map("organization_id")
  customerId     String     @map("customer_id")
  responsibleId  String     @map("responsible_id")
  kassaId        String?    @map("kassa_id")
  invoiceNumber  String     @map("invoice_number")
  saleDate       DateTime   @default(now()) @map("sale_date")
  totalAmount    Decimal    @map("total_amount")
  paidAmount     Decimal    @default(0.00) @map("paid_amount")
  currencyId     String     @map("currency_id")
  status         SaleStatus @default(DRAFT)
  notes          String?

  organization Organization         @relation(fields: [organizationId], references: [id])
  customer     OrganizationCustomer @relation(fields: [customerId], references: [id])
  responsible  User                 @relation(fields: [responsibleId], references: [id])
  currency     Currency             @relation(fields: [currencyId], references: [id])
  kassa        Kassa?               @relation(fields: [kassaId], references: [id])
  items        SaleItem[]
  payments     Payment[]            @relation("SalePayments")

  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  installments Installment[]
  documents    Document[]

  @@map("sales")
}

model SaleItem {
  id         String  @id @default(uuid())
  saleId     String  @map("sale_id")
  productId  String  @map("product_id")
  quantity   Int
  price      Decimal
  total      Decimal
  currencyId String  @map("currency_id")

  sale     Sale     @relation(fields: [saleId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])
  currency Currency @relation(fields: [currencyId], references: [id])
}

model Purchase {
  id             String         @id @default(uuid())
  organizationId String         @map("organization_id")
  supplierId     String         @map("supplier_id")
  responsibleId  String         @map("responsible_id")
  kassaId        String?        @map("kassa_id")
  invoiceNumber  String?        @map("invoice_number")
  purchaseDate   DateTime       @default(now()) @map("purchase_date")
  totalAmount    Decimal        @map("total_amount")
  paidAmount     Decimal        @default(0.00) @map("paid_amount")
  currencyId     String         @map("currency_id")
  status         PurchaseStatus @default(DRAFT)
  notes          String?

  organization Organization         @relation(fields: [organizationId], references: [id])
  supplier     OrganizationCustomer @relation(fields: [supplierId], references: [id])
  responsible  User                 @relation(fields: [responsibleId], references: [id])
  currency     Currency             @relation(fields: [currencyId], references: [id])
  kassa        Kassa?               @relation(fields: [kassaId], references: [id])
  items        PurchaseItem[]
  payments     Payment[]            @relation("PurchasePayments")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("purchases")
}

model PurchaseItem {
  id         String  @id @default(uuid())
  purchaseId String  @map("purchase_id")
  productId  String  @map("product_id")
  quantity   Int
  price      Decimal
  discount   Decimal @default(0.00) // ðŸ’¡ ÑÐºÐ¸Ð´ÐºÐ° (Ð½Ð° ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð°ÐºÑ†Ð¸Ð¹)
  total      Decimal

  purchase Purchase @relation(fields: [purchaseId], references: [id])
  product  Product  @relation(fields: [productId], references: [id])
}

model Installment {
  id             String            @id @default(uuid())
  saleId         String            @map("sale_id")
  customerId     String            @map("customer_id")
  totalAmount    Decimal           @default(0) @map("total_amount") // Ð¾Ð±Ñ‰Ð°Ñ ÑÑƒÐ¼Ð¼Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, $1000)
  initialPayment Decimal           @default(0) @map("initial_payment") // Ð¿ÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð·Ð½Ð¾Ñ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, $200)
  paidAmount     Decimal           @default(0) @map("paid_amount") // ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑƒÐ¶Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð¾
  remaining      Decimal           @default(0) // Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº
  totalMonths    Int               @default(0) @map("total_months") // Ð¸Ð·Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ñ‹Ð¹ ÑÑ€Ð¾Ðº (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, 8 Ð¼ÐµÑÑÑ†ÐµÐ²)
  monthsLeft     Int               @default(0) @map("months_left") // Ð¾ÑÑ‚Ð°Ð²ÑˆÐ¸Ð¹ÑÑ ÑÑ€Ð¾Ðº (Ð¿ÐµÑ€ÐµÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ)
  monthlyPayment Decimal           @default(0) @map("monthly_payment") // Ñ€Ð°ÑÑ‡ÐµÑ‚Ð½Ñ‹Ð¹ ÐµÐ¶ÐµÐ¼ÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð¿Ð»Ð°Ñ‚Ñ‘Ð¶
  dueDate        DateTime          @map("due_date") // ÐºÑ€Ð°Ð¹Ð½Ð¸Ð¹ ÑÑ€Ð¾Ðº Ð¿Ð¾Ð³Ð°ÑˆÐµÐ½Ð¸Ñ
  status         InstallmentStatus @default(PENDING)
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @updatedAt @map("updated_at")

  // relations
  sale     Sale                 @relation(fields: [saleId], references: [id])
  customer OrganizationCustomer @relation(fields: [customerId], references: [id])
  payments InstallmentPayment[]

  @@map("installments")
}

model InstallmentPayment {
  id            String   @id @default(uuid())
  installmentId String   @map("installment_id")
  amount        Decimal // ÑÑƒÐ¼Ð¼Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, $200)
  paidAt        DateTime @default(now()) @map("paid_at")
  paymentMethod String?  @map("payment_method") // Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: "cash", "click", "transfer"
  note          String? // ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹: "Ð·Ð° Ð½Ð¾ÑÐ±Ñ€ÑŒ", "Ð´Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð°Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð°"
  createdById   String?  @map("created_by_id")

  installment Installment @relation(fields: [installmentId], references: [id])
  created_by  User?       @relation(fields: [createdById], references: [id])
  payment     Payment?    @relation(fields: [paymentId], references: [id])
  paymentId   String?     @map("payment_id")

  @@map("installment_payments")
}

model Document {
  id             String       @id @default(uuid())
  organizationId String       @map("organization_id")
  customerId     String?      @map("customer_id")
  saleId         String?      @map("sale_id")
  type           DocumentType
  fileUrl        String       @map("file_url")
  uploadedById   String?      @map("uploaded_by")
  uploadedBy     User?        @relation(fields: [uploadedById], references: [id])
  createdAt      DateTime     @default(now()) @map("created_at")

  organization Organization          @relation(fields: [organizationId], references: [id])
  customer     OrganizationCustomer? @relation(fields: [customerId], references: [id])
  sale         Sale?                 @relation(fields: [saleId], references: [id])

  @@map("documents")
}

enum DocumentType {
  PASSPORT
  CONTRACT
  PAYMENT_RECEIPT
  OTHER
}

enum InstallmentStatus {
  PENDING // Ñ€Ð°ÑÑÑ€Ð¾Ñ‡ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°
  COMPLETED // Ð²ÑÑ‘ Ð²Ñ‹Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð¾
  OVERDUE // Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð°
  CANCELLED // Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð°
}

model Settings {
  id                   String    @id @default(uuid())
  organizationId       String    @unique @map("organization_id")
  baseCurrencyId       String    @map("base_currency_id")
  language             String?   @default("ru")
  dateFormat           String?   @default("DD.MM.YYYY")
  enableInstallment    Boolean   @default(true) //Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð»Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ñ€Ð°ÑÑÑ€Ð¾Ñ‡ÐºÐ¸ Ð¿Ñ€Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ðµ.
  enableNotifications  Boolean   @default(true) //Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼ Ð¸Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼.
  enableAutoRateUpdate Boolean   @default(false) //Ð Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÑƒÑ€ÑÐ¾Ð² Ð²Ð°Ð»ÑŽÑ‚.
  taxPercent           Decimal?  @default(0) //ÐžÐ±Ñ‰Ð¸Ð¹ Ð½Ð°Ð»Ð¾Ð³ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÐÐ”Ð¡).
  logoUrl              String?
  theme                ThemeType @default(LIGHT)

  organization Organization @relation(fields: [organizationId], references: [id])
  baseCurrency Currency     @relation(fields: [baseCurrencyId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

model Role {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?
  users       User[]

  @@map("roles")
}

model AuditLog {
  id             String   @id @default(uuid())
  organizationId String   @map("organization_id")
  userId         String?  @map("user_id")
  action         String
  entity         String
  entityId       String?  @map("entity_id")
  oldValue       Json?    @map("old_value")
  newValue       Json?    @map("new_value")
  createdAt      DateTime @default(now()) @map("created_at")

  organization Organization @relation(fields: [organizationId], references: [id])
  user         User?        @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

enum ThemeType {
  LIGHT
  DARK
  SYSTEM
}

enum PurchaseStatus {
  DRAFT // Ð§ÐµÑ€Ð½Ð¾Ð²Ð¸Ðº
  PARTIAL // Ð§Ð°ÑÑ‚Ð¸Ñ‡Ð½Ð¾ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð¾
  PAID // ÐŸÐ¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð¾
  CANCELLED // ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½Ð¾
}

enum PaymentTypeSale {
  CASH
  INSTALLMENT
  TRANSFER
}

enum SaleStatus {
  DRAFT
  PENDING
  PAID
  CANCELLED
}

enum RelatedType {
  SALE // Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð° â€” ÐºÐ»Ð¸ÐµÐ½Ñ‚ ÐºÑƒÐ¿Ð¸Ð» Ñ‚Ð¾Ð²Ð°Ñ€ â†’ Ð¾Ð½ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ
  PURCHASE // Ð·Ð°ÐºÑƒÐ¿ÐºÐ° â€” Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÑƒ
  PAYMENT // Ð¿Ð»Ð°Ñ‚Ñ‘Ð¶ â€” ÐºÑ‚Ð¾-Ñ‚Ð¾ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ð» (Ð¸Ð»Ð¸ Ð¼Ñ‹ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ð»Ð¸)
  REFUND // Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ â€” Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
  ADJUSTMENT // Ñ€ÑƒÑ‡Ð½Ð°Ñ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸)
  TRANSFER // Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ Ð¼ÐµÐ¶Ð´Ñƒ ÑÐ²Ð¾Ð¸Ð¼Ð¸ ÐºÐ°ÑÑÐ°Ð¼Ð¸
}

enum PaymentType {
  INCOME
  EXPENSE
  TRANSFER
}

enum ReferenceType {
  SALE
  PURCHASE
  OTHER
}

enum ProductAction {
  PURCHASED // Ñ‚Ð¾Ð²Ð°Ñ€ Ð·Ð°ÐºÑƒÐ¿Ð»ÐµÐ½
  SOLD // Ð¿Ñ€Ð¾Ð´Ð°Ð½
  RETURNED // Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ñ‘Ð½ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼
  RESOLD // Ð¿ÐµÑ€ÐµÐ¿Ñ€Ð¾Ð´Ð°Ð½
  TRANSFERRED // Ð¿ÐµÑ€ÐµÐ²ÐµÐ´Ñ‘Ð½ Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑÐ¼Ð¸
}

enum ProductStatus {
  IN_STOCK // Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð½Ð° ÑÐºÐ»Ð°Ð´Ðµ
  SOLD // Ð¿Ñ€Ð¾Ð´Ð°Ð½
  RETURNED // Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ñ‘Ð½
  LOST // ÑƒÑ‚ÐµÑ€ÑÐ½ / ÑÐ¿Ð¸ÑÐ°Ð½
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum OrgUserRole {
  OWNER
  ADMIN
  SELLER
  ACCOUNTANT
  MANAGER
}

enum CustomerType {
  CLIENT
  SUPPLIER
}

enum PriceType {
  CASH //Ð¦ÐµÐ½Ð° Ð¿Ñ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ / ÑÑ€Ð°Ð·Ñƒ
  INSTALLMENT //Ð Ð°ÑÑÑ€Ð¾Ñ‡ÐºÐ° (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð½Ð° 6/12 Ð¼ÐµÑÑÑ†ÐµÐ²)
  WHOLESALE //ÐžÐ¿Ñ‚Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°, Ð¿Ñ€Ð¸ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ñ… Ð¾Ð±ÑŠÑ‘Ð¼Ð°Ñ…
  ONLINE // Ñ†ÐµÐ½Ð° Ð² Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚-Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ðµ (Click / Telegram)
  SPECIAL // Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ð°Ñ ÑÐºÐ¸Ð´ÐºÐ° / Ð¿Ñ€Ð¾Ð¼Ð¾
}
